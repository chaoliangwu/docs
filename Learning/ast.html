<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>什么是AST | 7revor</title>
    <meta name="description" content="可爱又迷人的反派角色">
    <link rel="icon" href="/docs/img/favicon.ico">
    
    <link rel="preload" href="/docs/assets/css/0.styles.8cfe9ac6.css" as="style"><link rel="preload" href="/docs/assets/js/app.bc99d866.js" as="script"><link rel="preload" href="/docs/assets/js/5.725a8fde.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.ed429399.js"><link rel="prefetch" href="/docs/assets/js/11.f254633c.js"><link rel="prefetch" href="/docs/assets/js/12.b163d66e.js"><link rel="prefetch" href="/docs/assets/js/13.672afa93.js"><link rel="prefetch" href="/docs/assets/js/14.a222c189.js"><link rel="prefetch" href="/docs/assets/js/15.6cc44db7.js"><link rel="prefetch" href="/docs/assets/js/16.2c5bc323.js"><link rel="prefetch" href="/docs/assets/js/17.97efe9f1.js"><link rel="prefetch" href="/docs/assets/js/18.addf92e5.js"><link rel="prefetch" href="/docs/assets/js/19.671f398e.js"><link rel="prefetch" href="/docs/assets/js/2.a9bc8d68.js"><link rel="prefetch" href="/docs/assets/js/20.835d80cf.js"><link rel="prefetch" href="/docs/assets/js/21.56babc55.js"><link rel="prefetch" href="/docs/assets/js/22.345bd356.js"><link rel="prefetch" href="/docs/assets/js/23.c30ff3df.js"><link rel="prefetch" href="/docs/assets/js/24.3ec9cec4.js"><link rel="prefetch" href="/docs/assets/js/25.89435abb.js"><link rel="prefetch" href="/docs/assets/js/26.81dbd5b9.js"><link rel="prefetch" href="/docs/assets/js/27.9957afa5.js"><link rel="prefetch" href="/docs/assets/js/28.561890b4.js"><link rel="prefetch" href="/docs/assets/js/29.5f11397b.js"><link rel="prefetch" href="/docs/assets/js/3.d4f05896.js"><link rel="prefetch" href="/docs/assets/js/30.3703247d.js"><link rel="prefetch" href="/docs/assets/js/31.bc6a3ce2.js"><link rel="prefetch" href="/docs/assets/js/32.97ae4a2a.js"><link rel="prefetch" href="/docs/assets/js/33.5a0687b4.js"><link rel="prefetch" href="/docs/assets/js/4.8daa3127.js"><link rel="prefetch" href="/docs/assets/js/6.bd5143d1.js"><link rel="prefetch" href="/docs/assets/js/7.383fdf3a.js"><link rel="prefetch" href="/docs/assets/js/8.0e52f10d.js"><link rel="prefetch" href="/docs/assets/js/9.8117c74d.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.8cfe9ac6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">7revor</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/docs/Notes/" class="nav-link">Documents</a></div><div class="nav-item"><a href="/docs/Learning/" class="nav-link router-link-active">Learning</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/docs/Notes/" class="nav-link">Documents</a></div><div class="nav-item"><a href="/docs/Learning/" class="nav-link router-link-active">Learning</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/Learning/vuepress.html" class="sidebar-link">VuePress教程</a></li><li><a href="/docs/Learning/publish.html" class="sidebar-link">观察者模式&amp;发布-订阅模式</a></li><li><a href="/docs/Learning/bind.html" class="sidebar-link">双向数据绑定</a></li><li><a href="/docs/Learning/loop.html" class="sidebar-link">事件循环</a></li><li><a href="/docs/Learning/closure.html" class="sidebar-link">执行环境、作用域链与闭包</a></li><li><a href="/docs/Learning/catch.html" class="sidebar-link">全局异常捕获</a></li><li><a href="/docs/Learning/ast.html" class="active sidebar-link">抽象语法树</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/Learning/ast.html#什么是ast" class="sidebar-link">什么是AST</a></li><li class="sidebar-sub-header"><a href="/docs/Learning/ast.html#ast的结构" class="sidebar-link">AST的结构</a></li><li class="sidebar-sub-header"><a href="/docs/Learning/ast.html#送我们的螺丝刀" class="sidebar-link">送我们的螺丝刀</a></li></ul></li><li><a href="/docs/Learning/babelPlugin.html" class="sidebar-link">babel插件入门</a></li></ul> </div> <div class="page"> <div class="content"><h2 id="什么是ast"><a href="#什么是ast" class="header-anchor">#</a> 什么是AST</h2> <blockquote><p>在计算机科学中，抽象语法树（Abstract Syntax Tree，AST），或简称语法树（Syntax tree），是源代码语法结构的一种抽象表示。它以树状的形式表现编程语言的语法结构。</p></blockquote> <p>AST 的功能十分强大。大名鼎鼎的<code>webpack</code> <code>babel</code>等前端工具都是借助AST来实现的。</p> <p>AST在日常业务中也许很难涉及到。事实上，在javascript世界中，我们可以认为抽象语法树(AST)是最底层。 再往下，就是关于转换和编译的“黑魔法”领域了。</p> <h2 id="ast的结构"><a href="#ast的结构" class="header-anchor">#</a> AST的结构</h2> <p>说了这么多，我们来结合实例来看一下AST它到底长什么样子。</p> <p>现在我们拆解一个简单的 add 函数</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>
</code></pre></div><ul><li>首先，我们拿到的这个语法块，是一个函数声明<code>FunctionDeclaration</code>,接着拆解，它分为三块：
<ul><li><code>id</code> 就是它的名字，add</li> <li><code>params</code> 两个参数，a和b</li> <li><code>body</code> 大括号里的内容</li></ul></li></ul> <p>我们继续拆分，add 没法继续拆下去了，他是一个最基础的标记，就像是名字一样</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'add'</span>
    type<span class="token punctuation">:</span> <span class="token string">'identifier'</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>params 继续拆分，其实就是两个<code>identifier</code>组成的数组，之后也没办法再拆分了。</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">'a'</span>
        type<span class="token punctuation">:</span> <span class="token string">'identifier'</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">'b'</span>
        type<span class="token punctuation">:</span> <span class="token string">'identifier'</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>接下来，我们拆分 body</p> <p>body 其实是一个块状域<code>BlockStatement</code>，打开<code>BlockStatement</code>，里面是一个<code>ReturnStatement</code></p> <p>继续打开<code>ReturnStatement</code>,里面是一个二项式<code>BinaryExpression</code>，用来表示 <code>a + b</code></p> <p>继续打开<code>BinaryExpression</code>，它成了三部分，<code>left</code>，<code>operator</code>，<code>right</code></p> <ul><li><code>operator</code> : +</li> <li><code>left</code> :  a</li> <li><code>right</code>:  b</li></ul> <p>到这里，我们把一个简单的add函数拆解完毕，它的全部构成为</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Program&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
  <span class="token string">&quot;body&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;FunctionDeclaration&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
      <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
        <span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
        <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;add&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;expression&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token string">&quot;generator&quot;</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token string">&quot;params&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
          <span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
          <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
          <span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span>
          <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;b&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">&quot;body&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;BlockStatement&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token number">19</span><span class="token punctuation">,</span>
        <span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
        <span class="token string">&quot;body&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ReturnStatement&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
            <span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
            <span class="token string">&quot;argument&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;BinaryExpression&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
              <span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
              <span class="token string">&quot;left&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
                <span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> <span class="token number">33</span><span class="token punctuation">,</span>
                <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">&quot;operator&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;right&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
                <span class="token string">&quot;end&quot;</span><span class="token punctuation">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
                <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;b&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>看到这里，可能是要倒吸一口凉气。</p> <p>我靠，转换一个add函数就这么费劲，出来这么一大坨，那我们成百上千行的代码要何从下手？</p> <h2 id="送我们的螺丝刀"><a href="#送我们的螺丝刀" class="header-anchor">#</a> 送我们的螺丝刀</h2> <p>不要着急，AST 纵然很复杂，但是现在不需要我们重复造轮子。关于AST的解析、操作、转换已经有很多成熟的库帮我们封装好了。</p> <p><a href="https://www.babeljs.cn" target="_blank" rel="noopener noreferrer">Babel<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>就为我们封装好了一系列的工具。</p> <p>另外，可以通过<a href="https://astexplorer.net" target="_blank" rel="noopener noreferrer">AST explorer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来进行直观的树形结构转换。</p> <p>接下来，让我们使用AST技术来实现一个自动为代码增加<code>try-catch</code>的babel插件！</p> <p><a href="/docs/Learning/babelPlugin.html">查看下文</a></p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">8/2/2019, 4:01:01 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/Learning/catch.html" class="prev">
          全局异常捕获
        </a></span> <span class="next"><a href="/docs/Learning/babelPlugin.html">
          babel插件入门
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/docs/assets/js/app.bc99d866.js" defer></script><script src="/docs/assets/js/5.725a8fde.js" defer></script>
  </body>
</html>
