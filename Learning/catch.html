<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>引言 | 7revor</title>
    <meta name="description" content="可爱又迷人的反派角色">
    <link rel="icon" href="/docs/img/favicon.ico">
    
    <link rel="preload" href="/docs/assets/css/0.styles.8cfe9ac6.css" as="style"><link rel="preload" href="/docs/assets/js/app.bc99d866.js" as="script"><link rel="preload" href="/docs/assets/js/8.0e52f10d.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.ed429399.js"><link rel="prefetch" href="/docs/assets/js/11.f254633c.js"><link rel="prefetch" href="/docs/assets/js/12.b163d66e.js"><link rel="prefetch" href="/docs/assets/js/13.672afa93.js"><link rel="prefetch" href="/docs/assets/js/14.a222c189.js"><link rel="prefetch" href="/docs/assets/js/15.6cc44db7.js"><link rel="prefetch" href="/docs/assets/js/16.2c5bc323.js"><link rel="prefetch" href="/docs/assets/js/17.97efe9f1.js"><link rel="prefetch" href="/docs/assets/js/18.addf92e5.js"><link rel="prefetch" href="/docs/assets/js/19.671f398e.js"><link rel="prefetch" href="/docs/assets/js/2.a9bc8d68.js"><link rel="prefetch" href="/docs/assets/js/20.835d80cf.js"><link rel="prefetch" href="/docs/assets/js/21.56babc55.js"><link rel="prefetch" href="/docs/assets/js/22.345bd356.js"><link rel="prefetch" href="/docs/assets/js/23.c30ff3df.js"><link rel="prefetch" href="/docs/assets/js/24.3ec9cec4.js"><link rel="prefetch" href="/docs/assets/js/25.89435abb.js"><link rel="prefetch" href="/docs/assets/js/26.81dbd5b9.js"><link rel="prefetch" href="/docs/assets/js/27.9957afa5.js"><link rel="prefetch" href="/docs/assets/js/28.561890b4.js"><link rel="prefetch" href="/docs/assets/js/29.5f11397b.js"><link rel="prefetch" href="/docs/assets/js/3.d4f05896.js"><link rel="prefetch" href="/docs/assets/js/30.3703247d.js"><link rel="prefetch" href="/docs/assets/js/31.bc6a3ce2.js"><link rel="prefetch" href="/docs/assets/js/32.97ae4a2a.js"><link rel="prefetch" href="/docs/assets/js/33.5a0687b4.js"><link rel="prefetch" href="/docs/assets/js/4.8daa3127.js"><link rel="prefetch" href="/docs/assets/js/5.725a8fde.js"><link rel="prefetch" href="/docs/assets/js/6.bd5143d1.js"><link rel="prefetch" href="/docs/assets/js/7.383fdf3a.js"><link rel="prefetch" href="/docs/assets/js/9.8117c74d.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.8cfe9ac6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">7revor</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/docs/Notes/" class="nav-link">Documents</a></div><div class="nav-item"><a href="/docs/Learning/" class="nav-link router-link-active">Learning</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/docs/Notes/" class="nav-link">Documents</a></div><div class="nav-item"><a href="/docs/Learning/" class="nav-link router-link-active">Learning</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/Learning/vuepress.html" class="sidebar-link">VuePress教程</a></li><li><a href="/docs/Learning/publish.html" class="sidebar-link">观察者模式&amp;发布-订阅模式</a></li><li><a href="/docs/Learning/bind.html" class="sidebar-link">双向数据绑定</a></li><li><a href="/docs/Learning/loop.html" class="sidebar-link">事件循环</a></li><li><a href="/docs/Learning/closure.html" class="sidebar-link">执行环境、作用域链与闭包</a></li><li><a href="/docs/Learning/catch.html" class="active sidebar-link">全局异常捕获</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/Learning/catch.html#引言" class="sidebar-link">引言</a></li><li class="sidebar-sub-header"><a href="/docs/Learning/catch.html#try-catch" class="sidebar-link">try-catch</a></li><li class="sidebar-sub-header"><a href="/docs/Learning/catch.html#全局捕获" class="sidebar-link">全局捕获</a></li><li class="sidebar-sub-header"><a href="/docs/Learning/catch.html#未处理的promise异常" class="sidebar-link">未处理的Promise异常</a></li><li class="sidebar-sub-header"><a href="/docs/Learning/catch.html#使用ast自动为函数以及promise添加捕获" class="sidebar-link">使用AST自动为函数以及Promise添加捕获</a></li></ul></li><li><a href="/docs/Learning/ast.html" class="sidebar-link">抽象语法树</a></li><li><a href="/docs/Learning/babelPlugin.html" class="sidebar-link">babel插件入门</a></li></ul> </div> <div class="page"> <div class="content"><h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <p>现代前端应用面临的浏览器环境是非常复杂的，尤其是移动端页面。</p> <p>面对如此多样的浏览器环境，我们需要一种异常监控机制，在页面上有异常发生时，能够获得错误的基本信息、文件url、行号等。接下来我们探讨几种实现全局异常捕获的实现方式。</p> <h2 id="try-catch"><a href="#try-catch" class="header-anchor">#</a> try-catch</h2> <p>这个方法最简单粗暴，我们都写过<code>try-catch</code>。将可能会出错的代码使用<code>try-catch</code>包裹，就可以捕获到其中的错误：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token operator">...</span> <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>缺点也很明显，我们不确定哪些地方会出错，并且随着项目体积的增大，<code>try-catch</code>的代价也与日俱增。</p> <h2 id="全局捕获"><a href="#全局捕获" class="header-anchor">#</a> 全局捕获</h2> <p>好在浏览器为我们提供了全局的<code>window.onerror</code>事件，我们可以使用它来搜集页面上的错误：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token operator">...</span> <span class="token operator">...</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>其中</p> <ul><li><code>mesage</code> 异常基本信息</li> <li><code>source</code> 为发生异常的文件地址</li> <li><code>lineno</code> 错误行号</li></ul> <p>这种方式看似完美，其实有三个致命的问题。</p> <ul><li>由于浏览器的同源策略，当加载自不同域（协议、域名、端口三者任一不同）的脚本中发生语法错误时，为避免信息泄露，语法错误的细节将不会报告，而代之简单的<code>Script error</code></li> <li>我们发布到生产环境中的代码，往往都经过压缩混淆，文件名、函数名、变量名已经不具有可读性了需要借助<code>sourceMap</code>定位错误。</li> <li>无法捕获<code>Promise</code>中的异常</li></ul> <h2 id="未处理的promise异常"><a href="#未处理的promise异常" class="header-anchor">#</a> 未处理的Promise异常</h2> <p>使用<code>Promise</code>编写异步代码时，使用<code>reject</code>来处理错误。有时，开发者通常会忽略这一点，导致一些错误没有得到处理。</p> <p>一些浏览器(例如Chrome)能够捕获未处理的Promise错误。</p> <ul><li>监听<code>unhandledrejection</code>事件，即可捕获到未处理的<code>Promise</code>错误：</li></ul> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> ···<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="使用ast自动为函数以及promise添加捕获"><a href="#使用ast自动为函数以及promise添加捕获" class="header-anchor">#</a> 使用AST自动为函数以及Promise添加捕获</h2> <p>像我们上面所提到的，随着项目体积的逐渐增加，对每一个函数都手动添加<code>try-catch</code>无疑是一个巨大的工作量。</p> <p>那么有没有“偷懒”的方法呢？</p> <p>答案是肯定的。接下来我们介绍一种通过操作<code>AST</code>(抽象语法树)来为所有函数以及<code>Promise</code>添加捕获的方法。</p> <p><a href="/docs/Learning/ast.html">查看下文</a></p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">8/1/2019, 9:45:52 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/Learning/closure.html" class="prev">
          执行环境、作用域链与闭包
        </a></span> <span class="next"><a href="/docs/Learning/ast.html">
          抽象语法树
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/docs/assets/js/app.bc99d866.js" defer></script><script src="/docs/assets/js/8.0e52f10d.js" defer></script>
  </body>
</html>
