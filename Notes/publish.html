<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>主界面 | 7revor</title>
    <meta name="description" content="可爱又迷人的反派角色">
    <link rel="icon" href="/docs/img/favicon.ico">
    
    <link rel="preload" href="/docs/assets/css/0.styles.8cfe9ac6.css" as="style"><link rel="preload" href="/docs/assets/js/app.bc99d866.js" as="script"><link rel="preload" href="/docs/assets/js/17.97efe9f1.js" as="script"><link rel="preload" href="/docs/assets/js/2.a9bc8d68.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.ed429399.js"><link rel="prefetch" href="/docs/assets/js/11.f254633c.js"><link rel="prefetch" href="/docs/assets/js/12.b163d66e.js"><link rel="prefetch" href="/docs/assets/js/13.672afa93.js"><link rel="prefetch" href="/docs/assets/js/14.a222c189.js"><link rel="prefetch" href="/docs/assets/js/15.6cc44db7.js"><link rel="prefetch" href="/docs/assets/js/16.2c5bc323.js"><link rel="prefetch" href="/docs/assets/js/18.addf92e5.js"><link rel="prefetch" href="/docs/assets/js/19.671f398e.js"><link rel="prefetch" href="/docs/assets/js/20.835d80cf.js"><link rel="prefetch" href="/docs/assets/js/21.56babc55.js"><link rel="prefetch" href="/docs/assets/js/22.345bd356.js"><link rel="prefetch" href="/docs/assets/js/23.c30ff3df.js"><link rel="prefetch" href="/docs/assets/js/24.3ec9cec4.js"><link rel="prefetch" href="/docs/assets/js/25.89435abb.js"><link rel="prefetch" href="/docs/assets/js/26.81dbd5b9.js"><link rel="prefetch" href="/docs/assets/js/27.9957afa5.js"><link rel="prefetch" href="/docs/assets/js/28.561890b4.js"><link rel="prefetch" href="/docs/assets/js/29.5f11397b.js"><link rel="prefetch" href="/docs/assets/js/3.d4f05896.js"><link rel="prefetch" href="/docs/assets/js/30.3703247d.js"><link rel="prefetch" href="/docs/assets/js/31.bc6a3ce2.js"><link rel="prefetch" href="/docs/assets/js/32.97ae4a2a.js"><link rel="prefetch" href="/docs/assets/js/33.5a0687b4.js"><link rel="prefetch" href="/docs/assets/js/4.8daa3127.js"><link rel="prefetch" href="/docs/assets/js/5.725a8fde.js"><link rel="prefetch" href="/docs/assets/js/6.bd5143d1.js"><link rel="prefetch" href="/docs/assets/js/7.383fdf3a.js"><link rel="prefetch" href="/docs/assets/js/8.0e52f10d.js"><link rel="prefetch" href="/docs/assets/js/9.8117c74d.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.8cfe9ac6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">7revor</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/docs/Notes/" class="nav-link router-link-active">Documents</a></div><div class="nav-item"><a href="/docs/Learning/" class="nav-link">Learning</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/docs/Notes/" class="nav-link router-link-active">Documents</a></div><div class="nav-item"><a href="/docs/Learning/" class="nav-link">Learning</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/Notes/publish.html" class="active sidebar-link">发布宝贝</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#主界面" class="sidebar-link">主界面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#constructor" class="sidebar-link">constructor</a></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#componentdidmount" class="sidebar-link">componentDidMount</a></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#render" class="sidebar-link">render</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#宝贝主图" class="sidebar-link">宝贝主图</a></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#类目选择器category" class="sidebar-link">类目选择器category</a></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#宝贝描述" class="sidebar-link">宝贝描述</a></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#宝贝属性" class="sidebar-link">宝贝属性</a></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#宝贝规格（销售属性）" class="sidebar-link">宝贝规格（销售属性）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#填坑：" class="sidebar-link">填坑：</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#运费模板" class="sidebar-link">运费模板</a></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#发布总流程" class="sidebar-link">发布总流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#淘宝类目属性获取（规则获取）" class="sidebar-link">淘宝类目属性获取（规则获取）</a></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#商品发布-taobao-item-add" class="sidebar-link">商品发布 taobao.item.add</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#附：controller部分函数" class="sidebar-link">附：controller部分函数</a></li><li class="sidebar-sub-header"><a href="/docs/Notes/publish.html#附：component部分实现" class="sidebar-link">附：Component部分实现</a></li></ul></li><li><a href="/docs/Notes/goodsProps.html" class="sidebar-link">宝贝属性详解</a></li><li><a href="/docs/Notes/fieReactUpgrade.html" class="sidebar-link">fie升级React16实录</a></li></ul> </div> <div class="page"> <div class="content"><p>最近刚刚完成了前端的发布宝贝实现，在这里做一个梳理总结
</p> <h2 id="主界面"><a href="#主界面" class="header-anchor">#</a> 主界面</h2> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/main.png" style="width:300px;"> <p>主界面</p></div> <p>主界面作为整个模块的核心页面，承载所有子页面的数据收集，数据处理以及最终的数据拼接</p> <h3 id="constructor"><a href="#constructor" class="header-anchor">#</a> <code>constructor</code></h3> <ul><li><code>this.controller = new ItemAddController();</code></li></ul> <blockquote><p>控制主界面的各种函数</p></blockquote> <ul><li><code>state</code></li></ul> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code>     <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      pic_category_id<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//图片空间类目id,即（普云商品）</span>
      seller_cids<span class="token punctuation">:</span> <span class="token punctuation">{</span>value<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> cid<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//店铺类目</span>
      reg<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">//表单验证，价格，库存，标题是否符合规范</span>
        title<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        price<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        num<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/**
      * 最重要的商品属性
      **/</span>
      item<span class="token punctuation">:</span> <span class="token punctuation">{</span>  
        category<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//所选宝贝分类=&gt;eg. {根类目},{子类目},{叶子类目}，这么写的原因是为了降低category组件展示数据加载延迟</span>
        props_must<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//是否含有必填属性项</span>
        cid<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//所选类目id</span>
        has_sku<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>商品是否含有销售属性
        has_normal_prop<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        sku_prop<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//sku界面传来的属性</span>
        props<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//商品普通属性串</span>
        input_str<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>自定义属性串
        input_pids<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//自定义属性穿</span>
        desc<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//宝贝描述</span>
        title<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//标题</span>
        price<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//价格</span>
        num<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//库存</span>
        <span class="token comment">/**
         * 图片数据
         */</span>
        img<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">/**
         * 运费模板信息
         */</span>
        postage<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          template_id<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          address<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          item_weight<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          item_size<span class="token punctuation">:</span> <span class="token string">''</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        address<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">//发货地信息</span>
          provinceId<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          provinceValue<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          cityId<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          cityValue<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/**
         * 采购地信息
         */</span>
        purchase_option<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          purchase_place<span class="token punctuation">:</span> <span class="token string">'国内'</span><span class="token punctuation">,</span><span class="token comment">//采购地</span>
          purchase_country<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//采购国家</span>
          delivery_place<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">//发货地</span>
            key<span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
            value<span class="token punctuation">:</span> <span class="token string">'国内'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          inventory_type<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">//库存类型</span>
            key<span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
            value<span class="token punctuation">:</span> <span class="token string">'现货'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>主界面的<code>state</code>控制着用户对宝贝进行编辑后的所有数据处理以及展示</p></blockquote> <h3 id="componentdidmount"><a href="#componentdidmount" class="header-anchor">#</a> <code>componentDidMount</code></h3> <p>接下来，在页面渲染完成后，进行时间的绑定。由于<code>QAP</code>采用的是多页面架构，所以不同页面件的数据交互就需要通过<code>QAP</code>的事件机制来完成</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code> <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">/**
     * 图片选择
     */</span>
    <span class="token constant">QN</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'App.itemAdd.picSelect'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>controller<span class="token punctuation">.</span><span class="token function">refreshImg</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">/**
     * 采购地选择
     */</span>
    <span class="token constant">QN</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'App.itemAdd.purchasePlace'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>item<span class="token punctuation">.</span>purchase_option <span class="token operator">=</span> data
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">/**
     * sku编辑界面
     */</span>
    <span class="token constant">QN</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'App.itemAdd.skuAdd'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>item<span class="token punctuation">.</span>sku_prop<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>item<span class="token punctuation">.</span>price <span class="token operator">=</span> data<span class="token punctuation">.</span>min_price
      self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>reg<span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token boolean">true</span>
      self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">/**
     * 宝贝属性选择
     */</span>
    <span class="token constant">QN</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'App.itemAdd.propAdd'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>item<span class="token punctuation">.</span>input_pids <span class="token operator">=</span> data<span class="token punctuation">.</span>input_pids<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>item<span class="token punctuation">.</span>input_str <span class="token operator">=</span> data<span class="token punctuation">.</span>input_str<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>item<span class="token punctuation">.</span>props <span class="token operator">=</span> data<span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">/**
     * 宝贝详情
     */</span>
    <span class="token constant">QN</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'App.itemAdd.descSave'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>item<span class="token punctuation">.</span>desc <span class="token operator">=</span> data
      self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">/**
     * 类目选择
     */</span>
    <span class="token constant">QN</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'App.itemAdd.cidSelect'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        seller_cids<span class="token punctuation">:</span> data
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在界面加载完成后，判断用户图片空间是否存在普云商品发布目录，如果不存在给他新建一个
<code>this.controller.pic_space_folder_handler.call(this)</code><a href="#pic_space_folder_handler"> &gt;&gt;&gt;&gt;</a></p> <h3 id="render"><a href="#render" class="header-anchor">#</a> <code>render</code></h3> <p>主界面主要负责数据处理，它的视图比较简单，此处就不一一列举。
主要对表单验证自己实现了一个小组件。</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ActionRow</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span></span>
           <span class="token attr-name">required</span>
           <span class="token attr-name">label</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'一口价'</span><span class="token punctuation">}</span></span>
           <span class="token attr-name">type</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'input'</span><span class="token punctuation">}</span></span>
           <span class="token attr-name">htmlType</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'number'</span><span class="token punctuation">}</span></span>
           <span class="token attr-name">warn</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'一口价须精确到小数点后两位'</span><span class="token punctuation">}</span></span>
           <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>item<span class="token punctuation">.</span>price<span class="token punctuation">}</span></span>
           <span class="token attr-name">onInput</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
             self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>item<span class="token punctuation">.</span>price <span class="token operator">=</span> e<span class="token punctuation">.</span>value
           <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
           <span class="token attr-name">warnReg</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> regPrice <span class="token operator">=</span> <span class="token regex">/^\d+(\.\d{1,2})?$/</span><span class="token punctuation">,</span>
                    flag <span class="token operator">=</span> regPrice<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
              self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>reg<span class="token punctuation">.</span>price <span class="token operator">=</span> flag
              <span class="token keyword">return</span> flag
           <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="token punctuation">/&gt;</span></span>
</code></pre></div><p><code>ActionRow</code> <a href="#actionrow"> &gt;&gt;&gt;&gt;</a></p> <hr> <h2 id="宝贝主图"><a href="#宝贝主图" class="header-anchor">#</a> 宝贝主图</h2> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/main2.png" style="width:300px;"> <p>宝贝主图</p></div> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/main3.png" style="width:300px;"> <p>宝贝主图2</p></div> <p><strong>这里复用了林立全的主图拖拽排序组件</strong></p> <p>上传主图使用了三种方式，其中上传本地图片实现比较复杂：</p> <ol><li>调用千牛协议</li></ol> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code>     <span class="token constant">QN</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        api<span class="token punctuation">:</span><span class="token string">'selectFiles'</span><span class="token punctuation">,</span>
        query<span class="token punctuation">:</span><span class="token punctuation">{</span>
          actions <span class="token punctuation">:</span> type<span class="token punctuation">,</span><span class="token comment">//选取方式，本地相册和拍照</span>
          limit <span class="token punctuation">:</span> limit<span class="token punctuation">,</span><span class="token comment">//图片数量</span>
          representation<span class="token punctuation">:</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token comment">//图片质量比</span>
          maxWidth<span class="token punctuation">:</span><span class="token string">'750'</span><span class="token comment">//图片最大宽度</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>此协议可以得到图片的<code>local</code>地址:<code>file://localpath=%2fUsers%2f2b%2fDesktop%2ftest.txt</code></p></blockquote> <ol start="2"><li>将图片进行<code>Base64</code>转码</li></ol> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code> <span class="token constant">QN</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    api<span class="token punctuation">:</span><span class="token string">'getFileData'</span><span class="token punctuation">,</span>
    query<span class="token punctuation">:</span><span class="token punctuation">{</span>
      uris <span class="token punctuation">:</span> location
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>这里遇到一个问题，一次如果多个图片进行转换时，上面的是异步函数，如果用<code>Promise.all</code>一次执行多个，<code>IOS</code>可以正常转换，但是<code>Andriod</code>会报错，所以后期对图片转码进行了同步</p></blockquote> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">async</span> <span class="token function">upload</span> <span class="token punctuation">(</span><span class="token parameter">photos<span class="token punctuation">,</span> cat_id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span>  promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> photo <span class="token keyword">of</span> photos<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> guid <span class="token operator">=</span> Util<span class="token punctuation">.</span><span class="token function">guid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        uri <span class="token operator">=</span> photo<span class="token punctuation">.</span>uri<span class="token punctuation">,</span>
        type <span class="token operator">=</span> uri<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>uri<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> uri<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span>
        location <span class="token operator">=</span> uri <span class="token operator">+</span> <span class="token string">'&amp;mimetype=image/'</span> <span class="token operator">+</span> type<span class="token punctuation">,</span>
        base64 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getFileStream</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        img <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> guid <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> type<span class="token punctuation">,</span> data<span class="token punctuation">:</span> base64<span class="token punctuation">}</span>
        promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> guid <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> type<span class="token punctuation">,</span> cat_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> promises
  <span class="token punctuation">}</span>
</code></pre></div><p>3.调用<code>TOP</code>接口上传图片到图片空间</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code>  <span class="token constant">QN</span><span class="token punctuation">.</span>top<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      method<span class="token punctuation">:</span> <span class="token string">'taobao.picture.upload'</span><span class="token punctuation">,</span>
      img<span class="token punctuation">:</span>img<span class="token punctuation">,</span>
      picture_category_id<span class="token punctuation">:</span>cat_id<span class="token operator">||</span><span class="token number">0</span><span class="token punctuation">,</span>
      client_type<span class="token punctuation">:</span><span class="token string">'client:computer'</span><span class="token punctuation">,</span>
      image_input_title<span class="token punctuation">:</span>title
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>这里有一个大坑，之前调用这个接口，直接把<code>Base64</code>当做入参<code>img</code>一直报错，接口文档里也没有说明，后来才发现这个<code>img</code>入参是有格式要求的&gt;&gt;&gt;
<code>img = {name: guid + '.' + type, data: base64}</code></p></blockquote> <hr> <h2 id="类目选择器category"><a href="#类目选择器category" class="header-anchor">#</a> 类目选择器<code>category</code></h2> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/category.png" style="width:300px;"> <p>级联选择</p></div> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/category2.png" style="width:300px;"> <p>最近使用</p></div> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/category3.png" style="width:300px;"> <p>搜索</p></div> <blockquote><p>类目选选择器写成了一个弹窗式的组件，支持历史记录缓存，模糊查询。</p></blockquote> <ul><li><p>这里使用了<code>ReactNatice</code>的<code>Animated</code>类，整理了一下大体的使用方法，附：<a href="/docs/React/Animated.html">参考链接</a></p></li> <li><p>由于安卓和IOS的差异，呼起键盘时会出现遮挡输入框的问题，这里对此类问题给出一个通用
<a href="#heightprovider">处理方法</a></p></li> <li><p><a href="/docs/React/closeKeyBoard.html">QAP自动关闭键盘</a></p></li> <li><p>类目选择器的查询功能由于淘宝没有提供相应的接口，我们将类目数据存入自己的库中进行查询，和<strong>王炜</strong>对接。</p></li></ul> <hr> <h2 id="宝贝描述"><a href="#宝贝描述" class="header-anchor">#</a> 宝贝描述</h2> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/desc.png" style="width:300px;"> <p>宝贝描述</p></div> <p>这个地方没啥好说的，主要难点就是<code>QNUI</code>的多行输入框必须固定尺寸或者行数，没法根据文本长度自动撑开，和<code>pc</code>端不同的是，又没办法获取<code>dom</code>元素的尺寸，所以只能自己计算(有一定的偏差)</p> <ul><li>一个汉字差不多正好是两个字节的长度，一屏为24个汉字的长度</li></ul> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code> <span class="token function">getLength</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[\u0391-\uFFE5]/g</span><span class="token punctuation">,</span> <span class="token string">&quot;aa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>对<code>Input</code>的输入事件进行监听</li></ul> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code>onInput<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> str <span class="token operator">=</span> e<span class="token punctuation">.</span>value
      <span class="token keyword">const</span> arr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> rows <span class="token operator">=</span> arr<span class="token punctuation">.</span>length
      arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token keyword">const</span> length <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
          rows<span class="token operator">+=</span><span class="token function">parseInt</span><span class="token punctuation">(</span>length<span class="token operator">/</span><span class="token number">48</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
       value<span class="token punctuation">.</span>rows <span class="token operator">=</span> rows
       value<span class="token punctuation">.</span>v<span class="token operator">=</span>str
       self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre></div><blockquote><p>注：这里的<code>input</code>不可以使用受控用法，即绑定<code>value</code>，这样会导致<code>setState</code>时触发重新渲染，会打断<code>IOS</code>原生输入法的拼音输入，只绑定<code>defaultValue</code>就可以</p></blockquote> <p>图片上传采用了和宝贝主图一样的处理方式</p> <hr> <h2 id="宝贝属性"><a href="#宝贝属性" class="header-anchor">#</a> <a href="/docs/Notes/goodsProps.html">宝贝属性</a></h2> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/props.png" style="width:300px;"> <p>宝贝属性</p></div> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/props2.png" style="width:300px;"> <p>枚举属性</p></div> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/props3.png" style="width:300px;"> <p>普通度量衡</p></div> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/props4.png" style="width:300px;"> <p>时间度量衡</p></div> <ul><li>调用接口<code>taobao.itemprops.get</code>获取该类目下的所有属性，大致分为4类
<ol><li><strong>枚举属性</strong>，使用选择器进行选择，结果拼入<code>props</code>字段</li> <li><strong>自定义属性</strong>，用户自定义输入，结果拼入<code>input_pids</code> <code>input_str</code>字段</li> <li><strong>普通度量衡属性</strong>，含有可选单位和属性值，结果拼入<code>input_pids</code> <code>input_str</code>字段</li> <li><strong>时间度量衡属性</strong>，含有单位和属性值或者输入模板，结果拼入<code>input_pids</code> <code>input_str</code>字段</li></ol></li></ul> <blockquote><p><a href="https://open.taobao.com/doc.htm?docId=102629&docType=1" target="_blank" rel="noopener noreferrer">参考链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <hr> <h2 id="宝贝规格（销售属性）"><a href="#宝贝规格（销售属性）" class="header-anchor">#</a> 宝贝规格（销售属性）</h2> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/sku.png" style="width:300px;"> <p>sku</p></div> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/sku2.png" style="width:300px;"> <p>普通度量衡</p></div> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/sku3.png" style="width:300px;"> <p>备注</p></div> <ol><li><p>这里属性的处理逻辑和宝贝属性差不多，调用接口<code>taobao.itemprops.get</code>获取该类目下的销售属性<code>is_sale_prop===true</code></p> <ul><li>大致分为类
<ol><li><strong>颜色属性</strong><code>is_color_prop===true</code>,可长按输入备注，也可以进行自定义（暂时不考虑支持）</li> <li><strong>普通枚举属性</strong>，只可以选择不可以输入备注</li> <li><strong>自定义属性</strong>，用户可自定义输入</li> <li><strong>度量衡属性</strong>，需按模板格式填写，可对单位进行选择</li></ol> <blockquote><p>其中<strong>颜色属性</strong>和<strong>普通枚举属性</strong>拼入<code>sku_properties</code>字段，拼入<code>props</code>字段，所有<strong>用户自定义属性</strong>均拼入<code>sku_properties</code>字段，拼入<code>input_custon_cpv</code>字段，不拼入<code>props</code>字段，备注属性拼入<code>cpv_memo</code>字段</p></blockquote></li></ul></li> <li><p>商品有多个<code>sku</code>的情况，比如某商品有<code>颜色分类</code>，<code>长度</code>和<code>尺寸</code>三个销售属性，用户选择了两个颜色（白色，黑色），三个尺码（S,M,L），三个规格（大，中，小），那么该商品的sku总数为<code>2*3*3=18个</code></p></li></ol> <h3 id="填坑："><a href="#填坑：" class="header-anchor">#</a> 填坑：</h3> <ul><li>枚举属性的删除只需要在对应字段里将<code>pv</code>对去掉就可以，而自定义属性无论如何都删除不了，后来才发现要将入参<code>is_replace_sku</code>置为<code>true</code>才可以</li></ul> <hr> <h2 id="运费模板"><a href="#运费模板" class="header-anchor">#</a> 运费模板</h2> <div id="Picture" class="pic-container"><img src="/docs/img/itemAdd/postFee.png" style="width:300px;"> <p>运费模板</p></div> <p><strong>这里复用了林立全的运费模板组件</strong></p> <blockquote><p>注：当用户选择运费模板时，自定义的发货地字段无效，将会优先使用运费模板中的发货地</p></blockquote> <hr> <h2 id="发布总流程"><a href="#发布总流程" class="header-anchor">#</a> 发布总流程</h2> <h3 id="淘宝类目属性获取（规则获取）"><a href="#淘宝类目属性获取（规则获取）" class="header-anchor">#</a> 淘宝类目属性获取（规则获取）</h3> <h4 id="可发类目获取taobao-itemcats-get"><a href="#可发类目获取taobao-itemcats-get" class="header-anchor">#</a> 可发类目获取<code>taobao.itemcats.get</code></h4> <blockquote><ul><li>入参：<code>parent_cid=0</code></li> <li>出参：所有的可供发布的一级类目</li></ul></blockquote> <p>叶子类目获取：再次循环调用此接口，入参 <code>parent_cid=</code>选择一级类目<code>id</code>，获得下一级类目<code>id</code>，直至获取叶子类目</p> <p><strong>注意：商品需要挂靠在叶子类目发布</strong></p> <h4 id="标准商品类目属性获取taobao-itemprops-get"><a href="#标准商品类目属性获取taobao-itemprops-get" class="header-anchor">#</a> 标准商品类目属性获取<code>taobao.itemprops.get</code></h4> <blockquote><ul><li>入参：cid=1512(手机类目) 其他选填</li> <li>出参：所有的一级类目属性项和属性值</li></ul></blockquote> <h3 id="商品发布-taobao-item-add"><a href="#商品发布-taobao-item-add" class="header-anchor">#</a> 商品发布 <code>taobao.item.add</code></h3> <h4 id="发布步骤"><a href="#发布步骤" class="header-anchor">#</a> 发布步骤</h4> <ul><li>步骤1：必填字段准备–基本的信息字段值</li></ul> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;location.state&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;浙江&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;location.city&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;杭州&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;num&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;999&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;price&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;999&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;fixed&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;stuff_status&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;new&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;测试商品请不要拍&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;desc&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;这是一个好商品&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;cid&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;50000671&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li><p>步骤2：属性值填写</p> <blockquote><p>需拼接字段<code>props</code> <code>input_pids</code> <code>input_str</code> <code>input_custom_cpv</code> <code>sku_properties</code></p></blockquote> <ul><li>非销售属性拼接
<ul><li>普通属性值枚举
<ul><li>写入<code>props</code>字段， 填入<code>pid:vid</code> 来自类目属性值获取的结果</li></ul></li> <li>普通自定义输入属性值
<ul><li>写入<code>input_pids</code> <code>input_str</code></li> <li>不写入<code>props</code></li></ul></li></ul></li> <li>销售属性拼接
<ul><li>枚举值的销售属性
<ul><li>写入<code>props</code></li> <li>写入<code>sku_properties</code></li></ul></li> <li>自定义的销售属性
<ul><li>写入<code>input_custom_cpv</code></li> <li>写入<code>props</code></li> <li>写入<code>sku_properties</code></li></ul></li></ul></li> <li>SKU拼接
<ul><li>需拼接字段
<ul><li><code>sku_properties</code></li> <li><code>sku_quantities</code></li> <li><code>sku_prices</code></li> <li><code>sku_outer_ids</code></li> <li><code>sku_barcode</code></li></ul></li></ul></li></ul></li> <li><p>步骤3：图片上传</p> <ul><li>涉及API
<ul><li><code>taobao.picture.upload</code>(单张图片上传到图片空间)</li> <li><code>taobao.item.img.upload</code>（商品图片上传）</li> <li><code>taobao.item.propimg.upload</code>（商品属性图片上传）</li></ul></li></ul></li> <li><p>步骤4：图片关联</p> <ul><li><p>商品主图</p> <ul><li>使用<code>taobao.item.add</code> 接口操作
<blockquote><p>说明：可传图文件字节 image，也可传图片链接 pic_path ，两个都传，优先使用pic_path</p></blockquote></li></ul></li> <li><p>商品图片关联（发布成功后可以关联，需要商品id）</p> <ul><li><code>taobao.item.joint.img</code></li></ul></li> <li><p>属性图片关联（颜色图片，发布成功后可以关联，需要商品id）</p> <ul><li><code>taobao.item.joint.propimg</code></li></ul></li></ul></li> <li><p>步骤5：邮寄选项</p> <blockquote><p>注意：后台建好自己的运费模板，
涉及字段：<code>postage_id</code>（运费模板id）</p></blockquote></li> <li><p>步骤6：拼接整个商品发布字段</p></li></ul> <p>例：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code>param <span class="token operator">=</span> <span class="token punctuation">{</span>
    approve_status<span class="token punctuation">:</span> <span class="token string">&quot;onsale&quot;</span><span class="token punctuation">,</span>
    cid<span class="token punctuation">:</span> <span class="token number">50012413</span><span class="token punctuation">,</span>
    title<span class="token punctuation">:</span> <span class="token string">&quot;防踢被&quot;</span><span class="token punctuation">,</span>
    pic_path<span class="token punctuation">:</span> <span class="token string">&quot;i3/1810749336/O1CN01m2x81h2IpwB5oXTSS_!!1810749336.png&quot;</span><span class="token punctuation">,</span>
    price<span class="token punctuation">:</span> <span class="token string">&quot;120&quot;</span><span class="token punctuation">,</span>
    num<span class="token punctuation">:</span> <span class="token number">48</span><span class="token punctuation">,</span>
    desc<span class="token punctuation">:</span> <span class="token string">&quot;&lt;p&gt;儿童防踢睡袋&lt;/p&gt;&quot;</span><span class="token punctuation">,</span>
    
    props<span class="token punctuation">:</span> <span class="token string">&quot;20000:20455;122276315:3267702;20551:105255;20017:4306831;1627207:28321;122216547:3609877&quot;</span><span class="token punctuation">,</span>
    input_pids<span class="token punctuation">:</span> <span class="token string">&quot;13021751&quot;</span><span class="token punctuation">,</span>
    input_str<span class="token punctuation">:</span> <span class="token string">&quot;货号自定义&quot;</span><span class="token punctuation">,</span>
    
    sku_outer_ids<span class="token punctuation">:</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span>
    sku_prices<span class="token punctuation">:</span> <span class="token string">&quot;120,120&quot;</span><span class="token punctuation">,</span>
    sku_properties<span class="token punctuation">:</span> <span class="token string">&quot;1627207:28321;122216547:3609877,1627207:28321;122216547:-1&quot;</span><span class="token punctuation">,</span>
    sku_quantities<span class="token punctuation">:</span> <span class="token string">&quot;24,24&quot;</span><span class="token punctuation">,</span>
    input_custom_cpv<span class="token punctuation">:</span> <span class="token string">&quot;122216547:-1:小猪佩奇加绒款&quot;</span><span class="token punctuation">,</span>
    cpv_memo<span class="token punctuation">:</span> <span class="token string">&quot;1627207:28321:颜色偏淡&quot;</span><span class="token punctuation">,</span>
    
    postage_id<span class="token punctuation">:</span> <span class="token number">20589904471</span><span class="token punctuation">,</span>
    item_weight<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    seller_cids<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div><hr> <h2 id="附：controller部分函数"><a href="#附：controller部分函数" class="header-anchor">#</a> 附：<code>controller</code>部分函数</h2> <p><a id="pic_space_folder_handler"></a></p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code> <span class="token comment">/**
   * 图片空间文件夹处理
   */</span>
  <span class="token function">pic_space_folder_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token function">webSessionIsOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">//判断授权是否正常</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> sessionKey <span class="token operator">=</span> result<span class="token punctuation">.</span>sessionKey
        <span class="token keyword">const</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>sessionKey<span class="token punctuation">}</span>
        <span class="token function">categoryHandler</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            pic_category_id<span class="token punctuation">:</span> result<span class="token punctuation">.</span>data
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</code></pre></div><hr> <h2 id="附：component部分实现"><a href="#附：component部分实现" class="header-anchor">#</a> 附：<code>Component</code>部分实现</h2> <h4 id="actionrow"><a href="#actionrow" class="header-anchor">#</a> <code>ActionRow</code></h4> <p><a id="actionrow"></a></p> <div class="language-html extra-class"><pre class="language-html"><code>export default class ActionRow extends Component {
  constructor(props) {
    super(props)
    this.state={
      warn:false
    }
  }

  render() {
    const left = this.props.left || 0
    const border = style.bottomBorder
    return (
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{[style.actionRowContainer,</span>
        <span class="token attr-name"><span class="token namespace">{width:</span></span> <span class="token attr-name">750</span> <span class="token attr-name">-</span> <span class="token attr-name">left},</span>
        <span class="token attr-name">this.props.last</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">border,</span>
        <span class="token attr-name">this.props.blank</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name"><span class="token namespace">{marginBottom:</span></span> <span class="token attr-name">'18rem'},]}</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{style.required}</span><span class="token punctuation">&gt;</span></span>{this.props.required?'*':''}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Text</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{[style.actionRow,</span>
          <span class="token attr-name">!this.props.last</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">border,</span>
          <span class="token attr-name">this.props.style]}</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{{</span>
            <span class="token attr-name"><span class="token namespace">flexDirection:</span></span> <span class="token attr-name">'row',</span>
            <span class="token attr-name"><span class="token namespace">justifyContent:</span></span> <span class="token attr-name">'space-between',</span>
            <span class="token attr-name"><span class="token namespace">alignItem:</span></span> <span class="token attr-name">'center',</span>
            <span class="token attr-name"><span class="token namespace">width:</span></span> <span class="token attr-name">750</span> <span class="token attr-name">-</span> <span class="token attr-name">left</span> <span class="token attr-name">-</span> <span class="token attr-name">38</span>
          <span class="token attr-name">}}</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{[style.labelContainer,this.props.labelStyle]}</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{[style.labelText,this.props.labelStyle]}</span><span class="token punctuation">&gt;</span></span>{this.props.label}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Text</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>View</span><span class="token punctuation">&gt;</span></span>
            {this.renderAction()}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>View</span><span class="token punctuation">&gt;</span></span>
          {this.state.warn&amp;&amp;
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{style.warnContainer}</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{style.warning}</span><span class="token punctuation">&gt;</span></span>{this.props.warn}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Text</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>View</span><span class="token punctuation">&gt;</span></span>}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>View</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>View</span><span class="token punctuation">&gt;</span></span>
    )
  }

  renderAction() {
    if (this.props.type === 'input') {
      if (this.props.multi) {
        return (
          &lt;Input style={[style.multiInput, QN.os.ios &amp;&amp; {paddingLeft: '15rem'}]}
                 multiple={true}
                 ref={'multiple'}
                 id=&quot;multiple&quot;
                 placeholder={'请输入'}
                 defaultValue={this.props.value}
                 onInput={this.onInput.bind(this)}
                 rows={3}
          /&gt;
        )
      } else {
        if(this.props.disabled){
          return(
            &lt;View onClick={()=&gt;{Toast.toast('商品总库存不可编辑')}} style={style.disabled}&gt;
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{style.labelText}</span><span class="token punctuation">&gt;</span></span>{this.props.value||0}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Text</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>View</span><span class="token punctuation">&gt;</span></span>
          )
        }else{
          return(
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Input</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{style.input}</span>
                   <span class="token attr-name">disabled</span><span class="token attr-value"><span class="token punctuation">=</span>{this.props.disabled}</span>
                   <span class="token attr-name">htmlType</span><span class="token attr-value"><span class="token punctuation">=</span>{this.props.htmlType}</span>
                   <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span>{this.props.placeholder</span> <span class="token attr-name">||</span> <span class="token attr-name">'请输入'}</span>
                   <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>{this.props.value}</span>
                   <span class="token attr-name">onInput</span><span class="token attr-value"><span class="token punctuation">=</span>{this.onInput.bind(this)}</span>
            <span class="token punctuation">/&gt;</span></span>
            )
        }
      }
    } else {
      return (
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TouchableHighlight</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{style.selectContainer}</span> <span class="token attr-name">onPress</span><span class="token attr-value"><span class="token punctuation">=</span>{this.props.onPress}</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{[style.placeholder,</span>
            <span class="token attr-name">this.props.value</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name"><span class="token namespace">{color:</span></span> <span class="token attr-name">'#333333'},</span>
            <span class="token attr-name">this.props.disabled</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name"><span class="token namespace">{marginRight:</span></span> <span class="token attr-name">'50rem'}]}</span><span class="token punctuation">&gt;</span></span>
            {this.props.value || this.props.placeholder || '请选择'}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Text</span><span class="token punctuation">&gt;</span></span>
          {!this.props.disabled &amp;&amp; &lt;Icon name={'arrowRight'} style={style.arrowRight}/&gt;}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TouchableHighlight</span><span class="token punctuation">&gt;</span></span>
      )
    }
  }
  onInput(e){
    if(this.props.warnReg){
          this.setState({
            warn:!this.props.warnReg(e.value)
          })
      this.props.onInput(e)
    }else{
      this.props.onInput(e)
    }
  }
}
</code></pre></div><h4 id="heightprovider"><a href="#heightprovider" class="header-anchor">#</a> <code>HeightProvider</code></h4> <p><a id="heightProvider"></a></p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token constant">QN</span> <span class="token keyword">from</span> <span class="token string">'QAP-SDK'</span>
<span class="token keyword">let</span> componentMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//注册组件实例</span>
<span class="token keyword">let</span> keyBoardHeight<span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">QN</span><span class="token punctuation">.</span>os<span class="token punctuation">.</span>ios<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//安卓端处理</span>
  <span class="token constant">QN</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'Global.KeyboardWillShow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>height<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    keyBoardHeight<span class="token operator">=</span>height
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token constant">QN</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'Global.KeyboardWillHide'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    keyBoardHeight<span class="token operator">=</span><span class="token number">0</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//组件注册，如果组件需要进行高度调整，将组件实例添加到map，在高度变化时返回键盘高度</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>name<span class="token operator">&amp;&amp;</span>component<span class="token punctuation">.</span>instance<span class="token punctuation">)</span><span class="token punctuation">{</span>
    componentMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>name<span class="token punctuation">,</span>component<span class="token punctuation">.</span>instance<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> keyBoardHeight
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//组件注销</span>
  componentMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>componentMap<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//在高度变化时返回键盘高度</span>
<span class="token keyword">function</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>componentMap<span class="token punctuation">.</span>size<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> componentMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      v<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        keyBoardHeight<span class="token punctuation">:</span>keyBoardHeight
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="使用方法："><a href="#使用方法：" class="header-anchor">#</a> 使用方法：</h5> <ul><li>在组件构建完毕后进行注册</li></ul> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">let</span> keyBoardHeight <span class="token operator">=</span> <span class="token function">register</span><span class="token punctuation">(</span>CategorySelection<span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      keyBoardHeight<span class="token punctuation">:</span> keyBoardHeight
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>获取初始键盘高度，将其放入组件<code>state</code>中</p></blockquote> <ul><li>在<code>render</code>方法中动态为组件设置高度</li></ul> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>height<span class="token punctuation">,</span> width<span class="token punctuation">}</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">,</span><span class="token comment">//屏幕像素</span>
 pureHeight <span class="token operator">=</span> height <span class="token operator">/</span> <span class="token punctuation">(</span>width <span class="token operator">/</span> <span class="token number">750</span><span class="token punctuation">)</span> <span class="token comment">//屏幕真实高度（rem）</span>
 body_height <span class="token operator">=</span> pureHeight <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>keyBoardHeight<span class="token comment">//组件高度为真实高度减去键盘高度</span>

 <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span>  <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>style<span class="token punctuation">.</span>dialogWrap<span class="token punctuation">,</span> <span class="token punctuation">{</span>height<span class="token punctuation">:</span> height<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></code></pre></div><p>这样在呼出键盘时，由于我们已经将组件实例注册到<code>heightProvider</code>中，所以会自动调用<code>setState</code>方法触发重新渲染，更新键盘高度</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/24/2019, 6:22:56 AM</span></div></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/docs/Notes/goodsProps.html">
          宝贝属性详解
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/docs/assets/js/app.bc99d866.js" defer></script><script src="/docs/assets/js/17.97efe9f1.js" defer></script><script src="/docs/assets/js/2.a9bc8d68.js" defer></script>
  </body>
</html>
