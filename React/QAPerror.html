<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>关于QAP | 7revor</title>
    <meta name="description" content="可爱又迷人的反派角色">
    <link rel="icon" href="/docs/img/favicon.ico">
    
    <link rel="preload" href="/docs/assets/css/0.styles.8cfe9ac6.css" as="style"><link rel="preload" href="/docs/assets/js/app.bc99d866.js" as="script"><link rel="preload" href="/docs/assets/js/23.c30ff3df.js" as="script"><link rel="preload" href="/docs/assets/js/2.a9bc8d68.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.ed429399.js"><link rel="prefetch" href="/docs/assets/js/11.f254633c.js"><link rel="prefetch" href="/docs/assets/js/12.b163d66e.js"><link rel="prefetch" href="/docs/assets/js/13.672afa93.js"><link rel="prefetch" href="/docs/assets/js/14.a222c189.js"><link rel="prefetch" href="/docs/assets/js/15.6cc44db7.js"><link rel="prefetch" href="/docs/assets/js/16.2c5bc323.js"><link rel="prefetch" href="/docs/assets/js/17.97efe9f1.js"><link rel="prefetch" href="/docs/assets/js/18.addf92e5.js"><link rel="prefetch" href="/docs/assets/js/19.671f398e.js"><link rel="prefetch" href="/docs/assets/js/20.835d80cf.js"><link rel="prefetch" href="/docs/assets/js/21.56babc55.js"><link rel="prefetch" href="/docs/assets/js/22.345bd356.js"><link rel="prefetch" href="/docs/assets/js/24.3ec9cec4.js"><link rel="prefetch" href="/docs/assets/js/25.89435abb.js"><link rel="prefetch" href="/docs/assets/js/26.81dbd5b9.js"><link rel="prefetch" href="/docs/assets/js/27.9957afa5.js"><link rel="prefetch" href="/docs/assets/js/28.561890b4.js"><link rel="prefetch" href="/docs/assets/js/29.5f11397b.js"><link rel="prefetch" href="/docs/assets/js/3.d4f05896.js"><link rel="prefetch" href="/docs/assets/js/30.3703247d.js"><link rel="prefetch" href="/docs/assets/js/31.bc6a3ce2.js"><link rel="prefetch" href="/docs/assets/js/32.97ae4a2a.js"><link rel="prefetch" href="/docs/assets/js/33.5a0687b4.js"><link rel="prefetch" href="/docs/assets/js/4.8daa3127.js"><link rel="prefetch" href="/docs/assets/js/5.725a8fde.js"><link rel="prefetch" href="/docs/assets/js/6.bd5143d1.js"><link rel="prefetch" href="/docs/assets/js/7.383fdf3a.js"><link rel="prefetch" href="/docs/assets/js/8.0e52f10d.js"><link rel="prefetch" href="/docs/assets/js/9.8117c74d.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.8cfe9ac6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">7revor</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link router-link-active">React</a></div><div class="nav-item"><a href="/docs/Notes/" class="nav-link">Documents</a></div><div class="nav-item"><a href="/docs/Learning/" class="nav-link">Learning</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link router-link-active">React</a></div><div class="nav-item"><a href="/docs/Notes/" class="nav-link">Documents</a></div><div class="nav-item"><a href="/docs/Learning/" class="nav-link">Learning</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/React/TabBar.html" class="sidebar-link">导航栏组件</a></li><li><a href="/docs/React/Dialog.html" class="sidebar-link">动态弹窗</a></li><li><a href="/docs/React/ActionSheet.html" class="sidebar-link">动作菜单组件</a></li><li><a href="/docs/React/Animated.html" class="sidebar-link">ReactNative动画指南</a></li><li><a href="/docs/React/HOC.html" class="sidebar-link">组件逻辑复用</a></li><li><a href="/docs/React/titleWrapper.html" class="sidebar-link">简单实用的高阶组件</a></li><li><a href="/docs/React/closeKeyBoard.html" class="sidebar-link">QAP自动关闭键盘</a></li><li><a href="/docs/React/heightProvider.html" class="sidebar-link">组件样式响应键盘高度</a></li><li><a href="/docs/React/listView.html" class="sidebar-link">ListView长列表</a></li><li><a href="/docs/React/cardHoc.html" class="sidebar-link">卡片弹窗HOC</a></li><li><a href="/docs/React/context.html" class="sidebar-link">IOS高级功能控制</a></li><li><a href="/docs/React/middleware.html" class="sidebar-link">深入理解Redux中间件</a></li><li><a href="/docs/React/QAPerror.html" class="active sidebar-link">QAP异常捕获</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/React/QAPerror.html#关于qap" class="sidebar-link">关于QAP</a></li><li class="sidebar-sub-header"><a href="/docs/React/QAPerror.html#处理方式" class="sidebar-link">处理方式</a></li><li class="sidebar-sub-header"><a href="/docs/React/QAPerror.html#现状" class="sidebar-link">现状</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/React/QAPerror.html#问题" class="sidebar-link">问题</a></li><li class="sidebar-sub-header"><a href="/docs/React/QAPerror.html#两个角度" class="sidebar-link">两个角度</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/React/QAPerror.html#第一步" class="sidebar-link">第一步</a></li><li class="sidebar-sub-header"><a href="/docs/React/QAPerror.html#第二步" class="sidebar-link">第二步</a></li><li class="sidebar-sub-header"><a href="/docs/React/QAPerror.html#复用" class="sidebar-link">复用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/React/QAPerror.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/docs/React/QAPerror.html#缺点" class="sidebar-link">缺点</a></li></ul></li></ul></li></ul> </div> <div class="page"> <div class="content"><h2 id="关于qap"><a href="#关于qap" class="header-anchor">#</a> 关于QAP</h2> <p><strong>QAP</strong>，本质上来说就是<a href="https://alibaba.github.io/rax/" target="_blank" rel="noopener noreferrer">Rax<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。它是阿里基于weex和ReactNative自己又独立搞出来的一套架构。</p> <p>我们在web端如果想要进行全局的异常捕获，只需要对<code>window.onerror</code>事件进行监听就可以。</p> <p>而Rax是个异类。它的window对象上没有onerror这个事件，我们也就无法对错误进行全局监听。只有采用手动<code>try catch</code>的方法来捕获错误。</p> <p>但是设想一下如果为每一个方法都加上<code>try catch</code>，代码的可读性想必... ...</p> <h2 id="处理方式"><a href="#处理方式" class="header-anchor">#</a> 处理方式</h2> <ul><li>对逻辑层进行包装，为所有的方法自动添加<code>try catch</code></li> <li>分析AST(抽象语法树)，编写一个插件在代码编译时为每一个函数自动添加<code>try catch</code></li></ul> <blockquote><p>AST太高深了，我也不太懂哈哈哈🤣所以本文只介绍第一种方法</p></blockquote> <h2 id="现状"><a href="#现状" class="header-anchor">#</a> 现状</h2> <p>目前移动端项目中的逻辑层，基本是统一放在<code>controller</code>里面进行处理的。</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">GoodsDetail</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GoodsDetailController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// 所有的业务逻辑都是通过调用this.controller.XXX</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">GoodsDetailController</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
  <span class="token punctuation">}</span>
  <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
  <span class="token punctuation">}</span>
  <span class="token function-variable function">addTodo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样做对我们的下一步提供了极大的便利，我们只需要对<code>controller</code>动刀就可以了。</p> <h3 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h3> <p>就像刚才代码中所看到的，GoodsDetailController中定义的方法有些是直接定义</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
  <span class="token punctuation">}</span>
</code></pre></div><p>而有些是使用箭头函数定义</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token function-variable function">addTodo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
  <span class="token punctuation">}</span>
</code></pre></div><p>这里要引入一个小知识点：</p> <h4 id="直接定义的方法"><a href="#直接定义的方法" class="header-anchor">#</a> 直接定义的方法</h4> <p>根据 <code>ES6</code> class的特性，它是定义在<code>GoodsDetailController.prototype</code>中的，所有实例共享一份。</p> <p>换句话说，
<code>this.controller</code>实例上并没有<code>getTodos</code>这个方法，<code>this.controller.getTodos()</code>之所以能够调用成功，是因为当前对象没有找到该方法时，会沿着原型链向上查找，
当查找<code>this.controller.__proto__</code>也就是<code>GoodsDetailController.prototype</code>时，发现有<code>getTodos</code>这个方法，那么再调用。
<div id="Picture" class="pic-container"><img src="/docs/img/proto.png" style="width:undefinedpx;"> <p></p></div></p> <h4 id="箭头函数定义的方法"><a href="#箭头函数定义的方法" class="header-anchor">#</a> 箭头函数定义的方法</h4> <p>而在类中使用箭头函数定义的方法，不会定义在<code>GoodsDetailController.prototype</code>。他会在实例化该类时，为每一个实例自动绑定该方法，他们之间并不共享。</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">this</span><span class="token punctuation">.</span>controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GoodsDetailController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>controller1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GoodsDetailController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>controller<span class="token punctuation">.</span>getTodos <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>controller1<span class="token punctuation">.</span>getTodos<span class="token punctuation">)</span><span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>controller<span class="token punctuation">.</span>addTodo <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>controller1<span class="token punctuation">.</span>addTodo<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><h3 id="两个角度"><a href="#两个角度" class="header-anchor">#</a> 两个角度</h3> <p>根据上面的知识点，我们想要获取<code>this.controller</code>中所有的方法就要从两个角度出发</p> <ul><li>获取<code>GoodsDetailController</code>原型中的所有方法</li> <li>获取<code>this.controller</code>实例中的所有方法</li></ul> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>要知道，所有原型中的属性都是不可枚举的，我们不能采用<code>Object.keys()</code>来获取，这里需要借助<code>Object.getOwnPropertyNames()</code>。它在MDN中的定义如下：
返回一个由指定对象的所有自身属性的属性名（包括不可枚举属性但不包括Symbol值作为名称的属性）组成的数组</p></div> <h2 id="第一步"><a href="#第一步" class="header-anchor">#</a> 第一步</h2> <p>首先我们先获取<code>GoodsDetailController</code>原型中的所有方法</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> result <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建空对象</span>
<span class="token keyword">const</span> prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>controller<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取原型</span>
<span class="token keyword">const</span> names <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取原型上的不可枚举属性方法列表</span>
 names<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 遍历所有实例方法</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token operator">&amp;&amp;</span>key <span class="token operator">!==</span> <span class="token string">'constructor'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>controller<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reportInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误上报</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里需要注意一点，原型上方法在调用时，它的<code>this</code>指向可以通过<code>apply</code>、<code>call</code>或者<code>bind</code>改变。</p> <p>所以这里我们使用函数声明来定义方法，目的就是获取到该函数被调用时的<code>this</code>，然后使用<code>apply</code>继续为我们hack后的方法绑定原有的<code>this</code></p> <h2 id="第二步"><a href="#第二步" class="header-anchor">#</a> 第二步</h2> <p>接下来是获取实例中的所有方法，也就是通过箭头函数定义的方法。</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>controller<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 遍历实例方法，主要为通过箭头函数定义的方法</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>controller<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>controller<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>controller<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 箭头函数自动绑定this为this.controller</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reportInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误上报</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>这里的处理又和上面不同。原因是通过箭头函数定义的方法，无法使用<code>bind</code> <code>call</code>或者<code>apply</code>来改变<code>this</code>指向，所以他的<code>this</code>始终指向的是实例本身。</p> <h2 id="复用"><a href="#复用" class="header-anchor">#</a> 复用</h2> <p>我们将上面的逻辑简单封装一下，就得到一个可以复用的方法</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">LogAdvice</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">const</span> name <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>name<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 实例方法</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token operator">&amp;&amp;</span>key <span class="token operator">!==</span> <span class="token string">'constructor'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reportInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reportInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> target<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">GoodsDetail</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>controller <span class="token operator">=</span> <span class="token function">LogAdvice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GoodsDetailController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// 所有的业务逻辑都是通过调用this.controller.XXX</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h3> <p>使用<code>LogAdvice</code>可以捕获到所有同步代码中的错误，但是对于异步代码就无能为力了。比如说<code>Promise.catch</code>还是需要我们手动处理。</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/17/2019, 2:54:41 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/React/middleware.html" class="prev">
          深入理解Redux中间件
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/docs/assets/js/app.bc99d866.js" defer></script><script src="/docs/assets/js/23.c30ff3df.js" defer></script><script src="/docs/assets/js/2.a9bc8d68.js" defer></script>
  </body>
</html>
